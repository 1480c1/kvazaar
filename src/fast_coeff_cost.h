#ifndef FAST_COEFF_COST_H_
#define FAST_COEFF_COST_H_

#include <stdio.h>
#include "kvazaar.h"
// #include "encoderstate.h"

#define MAX_FAST_COEFF_COST_QP 50

typedef struct {
  uint64_t wts_by_qp[MAX_FAST_COEFF_COST_QP];
} fast_coeff_table_t;

// Weights for 4 buckets (coeff 0, coeff 1, coeff 2, coeff >= 3), for QPs from
// 0 to MAX_FAST_COEFF_COST_QP
static const float default_fast_coeff_cost_wts[][4] = {
  // Just extend it by stretching the first actual values..
  {0.455949, 3.497778, 3.503608, 6.689773},
  {0.455949, 3.497778, 3.503608, 6.689773},
  {0.455949, 3.497778, 3.503608, 6.689773},
  {0.455949, 3.497778, 3.503608, 6.689773},
  {0.455949, 3.497778, 3.503608, 6.689773},
  {0.455949, 3.497778, 3.503608, 6.689773},
  {0.455949, 3.497778, 3.503608, 6.689773},
  {0.455949, 3.497778, 3.503608, 6.689773},
  {0.455949, 3.497778, 3.503608, 6.689773},
  {0.455949, 3.497778, 3.503608, 6.689773},
  // up to here
  {0.455949, 3.497778, 3.503608, 6.689773},
  {0.427139, 3.475257, 3.534477, 6.624447},
  {0.341956, 3.828668, 3.539835, 6.610140},
  {0.298979, 3.906445, 3.578578, 6.566255},
  {0.261156, 3.946467, 3.640007, 6.565308},
  {0.216013, 4.034657, 3.481797, 6.583525},
  {0.165982, 4.304685, 3.421225, 6.589555},
  {0.140823, 4.463637, 3.310007, 6.576252},
  {0.127800, 4.512760, 3.143918, 6.584115},
  {0.114325, 4.559195, 3.141115, 6.520363},
  {0.139721, 4.407814, 3.154250, 6.457314},
  {0.124975, 4.419010, 3.164279, 6.413477},
  {0.088894, 4.665756, 3.039443, 6.452777},
  {0.076418, 4.755910, 3.074760, 6.401349},
  {0.068954, 4.796121, 3.049570, 6.359919},
  {0.053023, 4.915719, 2.912561, 6.330004},
  {0.039447, 5.024406, 2.864321, 6.305404},
  {0.044356, 4.943400, 3.124639, 6.174651},
  {0.024724, 5.106373, 2.983894, 6.292287},
  {0.020149, 5.130364, 3.091583, 6.241441},
  {0.014533, 5.177609, 3.118554, 6.200867},
  {0.015749, 5.102667, 3.335023, 6.155234},
  {0.007757, 5.189836, 3.525659, 6.246961},
  {0.007128, 5.262407, 3.350966, 6.215349},
  {0.005453, 5.374311, 3.474329, 6.020300},
  {0.004607, 5.333375, 3.765388, 6.007849},
  {0.003918, 5.023034, 4.249196, 6.320714},
  {0.003112, 5.422673, 3.862161, 5.825436},
  {0.001747, 5.185906, 4.338246, 6.428194},
  {0.001488, 5.215406, 4.378236, 6.461582},
  {0.000833, 5.313468, 4.259612, 6.237062},
  {0.000984, 5.331352, 4.373810, 6.467308},
  {0.000540, 5.451982, 4.234604, 6.372096},
  {0.000432, 5.488724, 4.242940, 6.378894},
  {0.000341, 5.504680, 4.280038, 6.480700},
  {0.000277, 5.533792, 4.285452, 6.512268},
  {0.000173, 5.726044, 3.881924, 6.421222},
  {0.000068, 5.866690, 3.716030, 6.472433},
  {0.000049, 6.100680, 3.385740, 6.082800},
  {0.000026, 6.314800, 3.151470, 6.066515},
  {0.000044, 6.298960, 3.391700, 5.690644},
};

typedef struct encoder_state_t encoder_state_t;

int kvz_fast_coeff_table_parse(fast_coeff_table_t *fast_coeff_table, FILE *fast_coeff_table_f);
void kvz_fast_coeff_use_default_table(fast_coeff_table_t *fast_coeff_table);
uint64_t kvz_fast_coeff_get_weights(const encoder_state_t *state);

#endif // FAST_COEFF_COST_H_
